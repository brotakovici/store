<input id="userInput" placeholder="User...">
<input id="passwordInput" placeholder="Password..." maxlength="4">
<button id="loginButton">Log in</button>


var userInput = document.getElementById('userInput');
var passwordInput = document.getElementById('passwordInput');
var button = document.getElementById('loginButton');

var ERROR_RATE = 200;

var pauseArray = [];
var lastPressed = null;

// Two cases, for the demo, one is with a pause before the last key, second one is with a pause in the middle.
var aliceRhythm = [100, 100, 800];
var alicePassword = '1234';

var bobRhythm = [100, 800, 100];
var bobPassword = '4321'; // Different password for the sake of it.

// Function that captures the rhythm.
var captureRhythm = function() {
  if(lastPressed === null)  {
  	lastPressed = new Date();
  }
  else if(pauseArray.length < 3){
  	var timestamp = new Date();
    var timeSincePressed = timestamp - lastPressed;
    pauseArray.push(timeSincePressed);
    lastPressed = timestamp;
  }
};

// Compares the rhythms
var compareRhythms = function(rhythm1, rhythm2, errRate, callback) {
	var result =  true;

  console.log(rhythm2);

  rhythm1.forEach(function(elem, index) {
  	var low = elem - errRate;
    var high = elem + errRate;
    console.log('<------------------------------>');
    console.log('low:' + low);
    console.log(rhythm2[index]);
    console.log('high:' + high);
    if(rhythm2[index] > low && rhythm2[index] < high)
    {
    	console.log(index + " checks out.")
    }
    else {
    	result = false
    }
  });

  return callback(result);
};

// Does the basic login, gets the username and the password, if password is correct, calls compare rhythm
var demoLogin = function() {
	var user = userInput.value;
  console.log(user);
 	var rhythm = null;
  var password = null;

  if(user === 'Bob'){
  	expectedPassword = bobPassword;
    expectedRhythm = bobRhythm;
  }
  else{
  	expectedPassword = alicePassword;
    expectedRhythm = aliceRhythm;
  }

  if(expectedPassword !== passwordInput.value)
  {
  	alert('Invalid username and/or password.');
  }
  else
  {
  	compareRhythms(expectedRhythm, pauseArray, ERROR_RATE, function (result) {
    	if(result){
      	alert('SUCCESS!');
      }
      else {
      	alert('Login unsuccessful.');
      }
    });
  }

};

// Listener that listens for key presses.
passwordInput.addEventListener('keypress', captureRhythm, false);
button.addEventListener('click', demoLogin, false);